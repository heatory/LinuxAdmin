# Администрирование Linux. ДЗ №3
## Работа с пользователями


## Цель:
> Работа состоит из 2х пунктов. `часть отмеченная "*" не обязательна к выполнению.`
> 1. Первая часть:
>  * Создать нескольких пользователей, задать им пароли, домашние директории и шеллы;
>  * Создать группу admin;
>  * Включить нескольких из ранее созданных пользователей, а также пользователя root, в группу admin;
>  * Запретить всем пользователям, кроме группы admin, логин в систему по SSH в выходные дни (суббота и воскресенье, без учета праздников).
>  * \* С учётом праздничных дней.
>  
>> (Для упрощения проверки можно разрешить парольную аутентификацию по SSH и использовать ssh user@localhost проверяя логин с этой же машины)
> ---
> 2. Вторая часть:
>  * Установить docker;
>  * Дать конкретному пользователю:
>    * права работать с docker (выполнять команды docker ps и т.п.);
>    * \* возможность перезапускать демон docker (systemctl restart docker) не выдавая прав более, чем для этого нужно;
---


## Часть 1

<details>
<summary>Подробности</summary>

---
### 1. Создание нескольких пользователей

Команда для создания пользователя `useradd <опции> <имя пользователя>`, ключ `-d /home/<имя пользователя>` для указания домашнего каталога пользователя, и ключ `-s <путь до исполнительного файла оболочки>` для указания используемой оболочки для данного пользователя.


Создадим несколько (3) пользователей с указанием домашней директории и путей для bash (в нашем случае) и зададим им пароли с помощью команды `passwd <Имя пользователя>`
![Создание пользователей](https://github.com/heatory/LinuxAdmin/blob/master/homework3/createusers.png "Создание пользователей")

Далее была добавлена группа `admins` (группа 'admin' уже была создана в системе) для этого была выполнена команда `sudo groupadd admins`. Далее с помощью команды `usermod -aG admins <Имя пользователя>` в группу были добавлены ранее созданные пользователи (только первый и второй, а также root).

![Создание группы пользователей](https://github.com/heatory/LinuxAdmin/blob/master/homework3/creategroup.png "Создание группы пользователей")

Для ограничения доступа по **ssh** был использован pam_script.
Необходимо первым делом установить pam_script в систему, так как он идет в составе пакета *libpam-script* то для установки используем команду `sudo apt install libpam-script`.

Далее, выполним команду `sudo vim /usr/share/libpam-script/pam_script_acct`, и напишем следующий код:

```bash
#!bin/bash
script="$1"
shift

if groups $PAM_USER | grep admin > /dev/null
then
        exit 0
else
        if [[ $(date +%u) -lt 6 ]]
        then
                exit 0
        else
                exit 1
        fi
fi

if [ ! -e "$script" ]
then
        exit 0
fi
```

Далее выполняем команду `sudo chmod +x /usr/share/libpam-script/pam_script_acct`, чтобы файл стал исполняемым.

Далее, необходимо добавить строчку `account    required     pam_script.so`  в файл `/etc/pam.d/sshd` :

![PAM script ssh](https://github.com/heatory/LinuxAdmin/blob/master/homework3/addssh.png "PAM script ssh")

Удостоверимся, что всё работает корректно.

В воскресенье, при попытке подключиться под разными пользователями получилась следующая ситуация: 

![Логин](https://github.com/heatory/LinuxAdmin/blob/master/homework3/login.png "Логин")

Пользователь user3, который не входит в группу **admins**, не смог войти, при этом пользователь user2 успешно подключился.

</details>


## Часть 2

<details>
<summary>Подробности</summary>

---
### 1. Установка docker'а


Установка docker'а производилась по инструкции с официального сайта Docker'а.

Удостоверимся, что docker установился командой `docker -v`:
![Докер](https://github.com/heatory/LinuxAdmin/blob/master/homework3/docker.png "Докер")


Залогинимся под, например, пользователем **user3** и попробуем вывести все образы:
![Докер образы](https://github.com/heatory/LinuxAdmin/blob/master/homework3/docker_images.png "Докер образы")

Видим, что нам недоступна эта команда, из-за отсутствия прав.

Далее с помощью всё той же команды `usermod -aG docker <Имя пользователя> добавим пользователя **user3** в группу *docker* и попробуем вывести образы снова:

![Докер образы](https://github.com/heatory/LinuxAdmin/blob/master/homework3/docker_images_after.png "Докер образы")

Видим, что всё ок.
</details>

